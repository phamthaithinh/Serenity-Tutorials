if(typeof global==="undefined")global=window;var Q$Externals={};Q$Externals.formatDayHourAndMin=function(e){if(e===0)return"0";else if(!e)return"";var t=Math.floor(e/24/60);var n="";if(t>0){n+=t.toString()}var r=$.pi.zeroPad(Math.floor(e%(24*60)/60),2)+":"+$.pi.zeroPad(e%60,2);if(r!="00:00"){if(t>0)n+=".";n+=r}return n};Q$Externals.formatISODateTimeUTC=function(e){if(e==null)return"";var t=function(e){return(e<10?"0":"")+e};var n=e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes());var r=Number(e.getUTCSeconds()+"."+(e.getUTCMilliseconds()<100?"0":"")+t(e.getUTCMilliseconds()));n+=":"+t(r)+"Z";return n};Q$Externals.formatNumber=function(e,t,n,r){var a="-";if(isNaN(e)){return null}var i="";if(t.indexOf(".")>-1){var o=n;var l=t.substring(t.lastIndexOf(".")+1);e=new Number(Q$Externals.roundNumber(e,l.length));var s=e%1;var u=new String(s.toFixed(l.length));u=u.substring(u.lastIndexOf(".")+1);for(var d=0;d<l.length;d++){if(l.charAt(d)=="#"&&u.charAt(d)!="0"){o+=u.charAt(d);continue}else if(l.charAt(d)=="#"&&u.charAt(d)=="0"){var f=u.substring(d);if(f.match("[1-9]")){o+=u.charAt(d);continue}else break}else if(l.charAt(d)=="0")o+=u.charAt(d)}i+=o}else e=Math.round(e);var c=Math.floor(e);if(e<0)c=Math.ceil(e);var p="";if(t.indexOf(".")==-1)p=t;else p=t.substring(0,t.indexOf("."));var h="";if(!(c==0&&p.substr(p.length-1)=="#")){var g=new String(Math.abs(c));var v=9999;if(p.lastIndexOf(",")!=-1)v=p.length-p.lastIndexOf(",")-1;var $=0;for(var d=g.length-1;d>-1;d--){h=g.charAt(d)+h;$++;if($==v&&d!=0){h=r+h;$=0}}if(p.length>h.length){var m=p.indexOf("0");if(m!=-1){var x=p.length-m;var Q=p.length-h.length-1;while(h.length<x){var y=p.charAt(Q);if(y==",")y=r;h=y+h;Q--}}}}if(!h&&p.indexOf("0",p.length-1)!==-1)h="0";i=h+i;if(e<0)i=a+i;if(i.lastIndexOf(n)==i.length-1){i=i.substring(0,i.length-1)}return i};Q$Externals.roundNumber=function(e,t){var n=Math.pow(10,t||0);var r=String(Math.round(e*n)/n);if(t>0){var a=r.indexOf(".");if(a==-1){r+=".";a=0}else{a=r.length-(a+1)}while(a<t){r+="0";a++}}return r};Q$Externals.isoRegexp=/(\d{4,})(?:-(\d{1,2})(?:-(\d{1,2})(?:[T ](\d{1,2}):(\d{1,2})(?::(\d{1,2})(?:\.(\d+))?)?(?:(Z)|([+-])(\d{1,2})(?::(\d{1,2}))?)?)?)?)?/;Q$Externals.logDateToString=function(e){if(e){return Q.formatDate(Q$Externals.parseISODateTime(e),Q$Culture.dateTimeFormat.replace(":ss",""))}else return""};Q$Externals.logDateUserToString=function(e,t){var n="";if(e){n=Q.formatDate($.pi.parseISODateTime(e),Q$Culture.dateTimeFormat.replace(":ss",""))}if(t&&t.length){if(n.length)n+=" ";n+="("+t+")"}return n};Q$Externals.logDateUserToShortString=function(e,t){var n="";if(e){n=Q.formatDate(Q$Externals.parseISODateTime(e),Q$Culture.dateFormat.replace("yyyy","yy"))}if(t&&t.length){if(n.length)n+=" ";n+=t}return n};Q$Externals.parseInteger=function(e){e=Q.trim(e.toString());var t=Q$Culture.get_groupSeperator();if(e&&e.length&&e.indexOf(t)>0){e=e.replace(new RegExp("(\\b\\d{1,3})\\"+t+"(?=\\d{3}(\\D|$))","g"),"$1")}if(!/^[-\+]?\d+$/.test(e))return NaN;return parseInt(e,10)};Q$Externals.parseDate=function(e,t){if(!e||!e.length)return null;var n;var r;var a,i,o;r=Q$Externals.splitDateString(e);if(!r)return false;if(r.length==3){t=t||Q$Culture.dateOrder;switch(t){case"dmy":a=parseInt(r[0],10);i=parseInt(r[1],10)-1;o=parseInt(r[2],10);break;case"ymd":a=parseInt(r[2],10);i=parseInt(r[1],10)-1;o=parseInt(r[0],10);break;case"mdy":default:a=parseInt(r[1],10);i=parseInt(r[0],10)-1;o=parseInt(r[2],10);break}if(isNaN(a)||isNaN(i)||isNaN(o)||a<1||a>31||i<0||i>11||o>9999||o<0)return false;if(o<100){var l=(new Date).getFullYear();var s=l%100+10;o+=l-l%100+(o<=s?0:-100)}try{n=new Date(o,i,a);if(isNaN(n.getFullYear()))return false}catch(u){return false}}else if(r.length==1){try{n=new Date(r[0]);if(isNaN(n.getFullYear()))return false}catch(u){return false}}return n};Q$Externals.parseDecimal=function(e){e=Q.trim(e.toString());var t=Q$Culture.get_groupSeperator();if(e&&e.length&&e.indexOf(t)>0){e=e.replace(new RegExp("(\\b\\d{1,3})\\"+t+"(?=\\d{3}(\\D|$))","g"),"$1")}if(!new RegExp("^\\s*([-\\+])?(\\d*)\\"+Q$Culture.decimalSeparator+"?(\\d*)\\s*$").test(e))return NaN;return parseFloat(e.toString().replace(Q$Culture.decimalSeparator,"."))};Q$Externals.splitDateString=function(e){e=$.trim(e);if(!e.length)return;var t;if(e.indexOf("/")>=0)t=e.split("/");else if(e.indexOf(".")>=0)t=e.split(".");else if(e.indexOf("-")>=0)t=e.split("-");else if(e.indexOf("\\")>=0)t=e.split("\\");else t=[e];return t};Q$Externals.parseISODateTime=function(e){if(!e||!e.length)return null;var t=Date.parse(e);if(!isNaN(t)&&typeof t=="Date")return t;e=e+"";if(typeof e!="string"||e.length===0){return null}var n=e.match(Q$Externals.isoRegexp);if(typeof n=="undefined"||n===null){return null}var r,a,i,o,l,s,u;r=parseInt(n[1],10);if(typeof n[2]=="undefined"||n[2]===""){return new Date(r)}a=parseInt(n[2],10)-1;i=parseInt(n[3],10);if(typeof n[4]=="undefined"||n[4]===""){return new Date(r,a,i)}o=parseInt(n[4],10);l=parseInt(n[5],10);s=typeof n[6]!="undefined"&&n[6]!==""?parseInt(n[6],10):0;if(typeof n[7]!="undefined"&&n[7]!==""){u=Math.round(1e3*parseFloat("0."+n[7]))}else{u=0}if((typeof n[8]=="undefined"||n[8]==="")&&(typeof n[9]=="undefined"||n[9]==="")){return new Date(r,a,i,o,l,s,u)}var d;if(typeof n[9]!="undefined"&&n[9]!==""){d=parseInt(n[10],10)*36e5;if(typeof n[11]!="undefined"&&n[11]!==""){d+=parseInt(n[11],10)*6e4}if(n[9]=="-"){d=-d}}else{d=0}return new Date(Date.UTC(r,a,i,o,l,s,u)-d)};Q$Externals.parseHourAndMin=function(e){var t=Q.trim(e);if(t.length<4||t.length>5)return NaN;var n,r;if(t.charAt(1)==":"){n=$.pi.parseInteger(t.substr(0,1));r=$.pi.parseInteger(t.substr(2,2))}else{if(t.charAt(2)!=":")return NaN;n=$.pi.parseInteger(t.substr(0,2));r=$.pi.parseInteger(t.substr(3,2))}if(isNaN(n)||isNaN(r)||n<0||n>23||r<0||r>59)return NaN;return n*60+r};Q$Externals.parseDayHourAndMin=function(e){var t;var n=Q.trim(e);if(!n)return NaN;n=n.split(".");if(n.length==0||n.length>2)return NaN;if(n.length==1){t=$.pi.parseInteger(n[0]);if(!isNaN(t))return t*24*60;return $.pi.parseHourAndMin(n[0])}else{t=$.pi.parseInteger(n[0]);var r=$.pi.parseHourAndMin(n[1]);if(isNaN(t)||isNaN(r))return NaN;return t*24*60+r}};Q$Externals.parseQueryString=function(e){var t;if(arguments.length==0)t=location.search.substring(1,location.search.length);else t=e||"";var n={};var r=t.split("&");for(var a=0;a<r.length;a++){var i=r[a].split("=");var o=decodeURIComponent(i[0]);n[o]=i.length>=2?decodeURIComponent(i[1]):o}return n};Q$Externals.turkishLocaleCompare=function(e,t){var n="AaBbCcÇçFfGgĞğHhIıİiJjKkLlMmNnOoÖöPpRrSsŞşTtUuÜüVvYyZz";e=e||"";t=t||"";if(e==t)return 0;if(!Q$Externals.turkishLocaleIndex){Q$Externals.turkishLocaleIndex={};for(var r=0;r<n.length;r++){Q$Externals.turkishLocaleIndex[n.charAt(r)]=r+1}}for(var a=0,i=Math.min(e.length,t.length);a<i;a++){var o=e.charAt(a),l=t.charAt(a);if(o===l)continue;var s=Q$Externals.turkishLocaleIndex[o],u=Q$Externals.turkishLocaleIndex[l];if(s!=null&&u!=null)return s<u?-1:1;var d=o.localeCompare(l);if(d==0)continue;return d}return e.localeCompare(t)};Q$Externals.turkishLocaleToUpper=function(e){if(!e)return e;return e.replace(/i/g,"İ").replace(/ı/g,"I").toUpperCase()};Q$Externals.alertDialog=function(e,t){var n;t=$.extend({htmlEncode:true,okButton:Q.text("Dialogs.OkButton"),title:Q.text("Dialogs.AlertTitle"),onClose:null,onOpen:null,autoOpen:false,dialogClass:"s-MessageDialog s-AlertDialog",modal:true,width:"40%",maxWidth:"450",minWidth:"180",resizable:false,open:function(){if(t.onOpen)t.onOpen.call(this)},close:function(){n.dialog("destroy");if(t.onClose)t.onClose()}},t);if(t.htmlEncode)e=Q.htmlEncode(e);if(!t.buttons){var r=[];r.push({text:t.okButton,click:function(){n.dialog("close")}});t.buttons=r}n=$('<div><div class="message"></div></div>').dialog(t).children(".message").html(e).parent().dialog("open")};Q$Externals.confirmDialog=function(e,t,n){var r;n=$.extend({htmlEncode:true,yesButton:Q.text("Dialogs.YesButton"),noButton:Q.text("Dialogs.NoButton"),title:Q.text("Dialogs.ConfirmationTitle"),onNo:null,onCancel:null,onClose:null,autoOpen:false,modal:true,dialogClass:"s-MessageDialog s-ConfirmDialog",width:"40%",maxWidth:"450",minWidth:"180",resizable:false,open:function(){if(n.onOpen)n.onOpen.call(this)},close:function(){r.dialog("destroy");if(!a&&n.onCancel)n.onCancel()},overlay:{opacity:.7,background:"black"}},n);if(n.htmlEncode)e=Q.htmlEncode(e);var a=false;if(!n.buttons){var i=[];i.push({text:n.yesButton,click:function(){a=true;r.dialog("close");if(t)t()}});if(n.noButton)i.push({text:n.noButton,click:function(){a=true;r.dialog("close");if(n.onNo)n.onNo();else if(n.onCancel)n.onCancel()}});n.buttons=i}r=$('<div><div class="message"></div></div>').dialog(n).children(".message").html(e).parent().dialog("open")};Q$Externals.iframeDialog=function(e){var t;var n=$("<div><iframe></iframe></div>");var r=$.extend({autoOpen:true,modal:true,width:"60%",height:"400",title:Q.text("Dialogs.AlertTitle"),open:function(){t=n.find("iframe").css({border:"none",width:"100%",height:"100%"})[0].contentDocument;t.open();t.write(r.html);t.close()},close:function(){t.open();t.write("");t.close();n.dialog("destroy").html("")}},e);n.dialog(r)};Q$Externals.setupAjaxIndicator=function(){var e=null;var t=0;$(document).ajaxStart(function(){window.clearTimeout(t);t=window.setTimeout(function(){if(!e)e=$("<div/>").addClass("s-AjaxIndicator").appendTo(document.body)},2e3)}).ajaxStop(function(){if(e){e.remove();e=null}window.clearTimeout(t)})};Q$Externals.toId=function(e){if(e==null)return null;if(typeof e=="number")return e;e=$.trim(e);if(e==null||!e.length)return null;if(e.length>=15)return e;return parseInt(e,10)};var oldShowLabel;Q$Externals.validateShowLabel=function(e,t){oldShowLabel.call(this,e,t);this.errorsFor(e).each(function(e,t){$(t).attr("title",$(t).text())})};Q$Externals.jQueryValidationInitialization=function(){Serenity.CustomValidation.registerValidationMethods();oldShowLabel=$.validator.prototype.showLabel;$.validator.prototype.showLabel=Q$Externals.validateShowLabel;jQuery.validator.addMethod("xss",function(e,t){if(e.length==0)return true;var n=0;while(true){var r=e.indexOf("&",n);if(r<0)r=e.indexOf("<",n);if(r<0)return true;if(r==e.length-1)return true;var a=e.charAt(r);var i=e.charAt(r+1);if(a!="&"){if(a=="<"&&(i>="a"&&i<="z"||i>="A"&&i<="Z"||i=="!"||i=="/"))return false}else if(i=="#")return false;n=r+1}});$.validator.addMethod("dateQ",function(e,t){return this.optional(t)||Q$Externals.parseDate(e)!=false});$.validator.addMethod("hourAndMin",function(e,t){return this.optional(t)||!isNaN(Q.parseHourAndMin(e))});$.validator.addMethod("dayHourAndMin",function(e,t){return this.optional(t)||!isNaN(Q.parseDayHourAndMin(e))});$.validator.addMethod("decimalQ",function(e,t){return this.optional(t)||!isNaN(Q.parseDecimal(e))});$.validator.addMethod("integerQ",function(e,t){return this.optional(t)||!isNaN(Q.parseInteger(e))});var e=$.validator.methods.email;$.validator.addMethod("email",function(t,n){if(!Q$Config.emailAllowOnlyAscii)return e.call(this,t,n);return this.optional(n)||/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)});$.validator.addMethod("emailMultiple",function(e,t){var n=this.optional(t);if(n)return n;if(e.indexOf(";")>=0)e=e.split(";");else e=e.split(",");for(var r=0;r<e.length;r++){n=$.validator.methods.email.call(this,e[r],t);if(!n)return n}return n});$.validator.addMethod("anyvalue",function(e,t){return true});$.validator.defaults.ignoreTitle=true;$.validator.defaults.onchange=function(e){this.element(e)};$.validator.prototype.oldinit=$.validator.prototype.init;$.validator.prototype.init=function(){$.validator.prototype.oldinit.call(this);function e(e){if(this.form==null)return;var t=$.data(this.form,"validator"),n="on"+e.type.replace(/^validate/,"");t&&t.settings[n]&&t.settings[n].call(t,this)}function t(t){var n=this[0];if(!$.data(n,"changebound")){$(n).change(e);$.data(n,"changebound",true)}}$(this.currentForm).on(":text, :password, :file, select, textarea","focusin.validate",t)};$.validator.prototype.oldfocusInvalid=$.validator.prototype.focusInvalid;$.validator.prototype.focusInvalid=function(){if(this.settings.abortHandler)this.settings.abortHandler(this);this.oldfocusInvalid.call(this)};$.validator.prototype.oldstopRequest=$.validator.prototype.focusInvalid;$.validator.prototype.stopRequest=function(e,t){var n=this.formSubmitted;this.oldfocusInvalid.call(this,[e,t]);if(!t&&this.pendingRequest==0&&n&&this.settings.abortHandler){this.settings.abortHandler(this)}};$.validator.prototype.resetAll=function(){this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)};jQuery(function(){$.extend($.validator.messages,{email:Q.text("Validation.Email"),required:Q.text("Validation.Required"),minlength:Q.text("Validation.MinLength"),maxlength:Q.text("Validation.MaxLength"),digits:Q.text("Validation.Digits"),range:Q.text("Validation.Range"),xss:Q.text("Validation.Xss"),dateQ:Q.text("Validation.DateInvalid"),decimalQ:Q.text("Validation.Decimal"),integerQ:Q.text("Validation.Integer"),url:Q.text("Validation.Url")})})};Q$Externals.validatorAbortHandler=function(e){e.settings.abortHandler=null;e.settings.submitHandler=function(){return false}};Q$Externals.validateOptions=function(e){return $.extend({ignore:":hidden",meta:"v",errorClass:"error",errorPlacement:function(e,t){var n=null;var r=t.attr("data-vx-id");if(r){n=$("#"+r);if(!n.length)n=null;else n=n[0]}if(n==null){n=t.parents("div.field");if(n.length){var a=$("div.vx",n[0]);if(a.length)n=a[0]}else n=t.parent()}e.appendTo(n)},submitHandler:function(){return false},invalidHandler:function(){Q.notifyError(Q.text("Validation.InvalidFormMessage"),"error")},success:function(e){e.addClass("checked")}},e)};if(window.jQuery&&window.jQuery.validator)Q$Externals.jQueryValidationInitialization();else if(window.jQuery){jQuery(function(e){if(e.validator)Q$Externals.jQueryValidationInitialization()})}Q$Externals.jQueryDatepickerInitialization=function(){var e=Q$Culture.dateOrder;var t=Q$Culture.dateSeparator;var n=($("html").attr("lang")||"en").toLowerCase();if(!$.datepicker.regional[n]){n=n.split("-")[0];if(!$.datepicker.regional[n]){n="en"}}$.datepicker.setDefaults($.datepicker.regional["en"]);$.datepicker.setDefaults($.datepicker.regional[n]);$.datepicker.setDefaults({dateFormat:e=="mdy"?"mm"+t+"dd"+t+"yy":e=="ymd"?"yy"+t+"mm"+t+"dd":"dd"+t+"mm"+t+"yy",buttonImage:Q.resolveUrl("~/content/serenity/images/datepicker.gif"),buttonImageOnly:true,showOn:"both",showButtonPanel:true,changeMonth:true,changeYear:true})};if(window.jQuery&&window.jQuery.datepicker&&window.jQuery.datepicker.regional&&window.jQuery.datepicker.regional.en)Q$Externals.jQueryDatepickerInitialization();else jQuery(function(e){if(e.datepicker)Q$Externals.jQueryDatepickerInitialization()});Q$Externals.jQuerySelect2Initialization=function(){$.ui.dialog.prototype._allowInteraction=function(e){if($(e.target).closest(".ui-dialog").length){return true}return!!$(e.target).closest(".ui-datepicker, .select2-drop, .cke, .cke_dialog, #support-modal").length}};if(window.jQuery&&window.jQuery.ui)Q$Externals.jQuerySelect2Initialization();else jQuery(function(e){if(window.jQuery.ui)Q$Externals.jQuerySelect2Initialization()});Q$Externals.postToService=function(e){var t=$("<form/>").attr("method","POST").attr("action",e.url?Q.resolveUrl(e.url):Q.resolveUrl("~/services/"+e.service)).appendTo(document.body);if(e.target)t.attr("target",e.target);var n=$("<div/>").appendTo(t);$("<input/>").attr("type","hidden").attr("name","request").val($.toJSON(e.request)).appendTo(n);$("<input/>").attr("type","submit").appendTo(n);t.submit();window.setTimeout(function(){t.remove()},0)};Q$Externals.postToUrl=function(e){var t=$("<form/>").attr("method","POST").attr("action",Q.resolveUrl(e.url)).appendTo(document.body);if(e.target)t.attr("target",e.target);var n=$("<div/>").appendTo(t);if(e.params!=null){for(var r in e.params){$("<input/>").attr("type","hidden").attr("name",r).val(e.params[r]).appendTo(n)}}$("<input/>").attr("type","submit").appendTo(n);t.submit();window.setTimeout(function(){t.remove()},0)};Q$Externals.ssExceptionInitialization=function(){window.ss.Exception.prototype.toString=function(){return this.get_message()}};if(window.ss&&window.ss.Exception)Q$Externals.ssExceptionInitialization();else jQuery(function(e){if(window.ss&&window.ss.Exception)Q$Externals.ssExceptionInitialization()});global.Q$Externals=Q$Externals;function showInFrame(e){height=screen.availHeight-60;width=screen.availWidth-10;var t=(screen.availWidth-width)/2-5;if(t<0)t=0;var n=(screen.availHeight-height)/2-25;if(n<0)n=0;var r=window.open("","","status=0, toolbar=0, width="+width+", height="+height+", scrollbars=1, resizable=yes, left="+t+", top="+n);r.document.body.innerHTML=e}if($.fn.button&&$.fn.button.noConflict){var btn=$.fn.button.noConflict();$.fn.btn=btn}Q$Externals.deepClone=function(){var e,t,n,r,a,i,o=arguments[0]||{},l=1,s=arguments.length;if(typeof o!=="object"&&!$.isFunction(o)){o={}}if(l===s){o={};l=0}for(;l<s;l++){if((e=arguments[l])!==null){if($.isArray(e)){o=$.extend(true,[],e)}else{for(t in e){n=o[t];r=e[t];if(o===r){continue}if(r&&($.isPlainObject(r)||(a=$.isArray(r)))){if(a){a=false;i=n&&$.isArray(n)?n:[]}else{i=n&&$.isPlainObject(n)?n:{}}o[t]=Q$Externals.deepClone(i,r)}else if(r!==undefined){o[t]=r}}}}}return o};